% -*- coding: utf-8; ispell-local-dictionary: "en_US" -*-
%\documentclass[sigconf,screen=true]{acmart}
\documentclass[manuscript]{acmart}

\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

\acmConference[Woodstock '18]{Woodstock '18: ACM Symposium on Neural
  Gaze Detection}{June 03--05, 2018}{Woodstock, NY}
\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
  June 03--05, 2018, Woodstock, NY}
\acmPrice{15.00}
\acmISBN{978-1-4503-XXXX-X/18/06}

\usepackage{standalone}

\usepackage[draft]{das}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{comment}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{upgreek}
%\usepackage[linesnumbered,ruled,noline]{algorithm2e}
\usepackage{algpseudocode}
\usepackage{algorithm}
\usepackage{stfloats}
\usepackage{subfigure}
\usepackage[detect-none]{siunitx}
\usepackage{relsize}
\usepackage{multirow}
\usepackage{url}
\usepackage{tikz}
\usetikzlibrary{automata}
\usetikzlibrary{matrix}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}
\usetikzlibrary{shapes.arrows}
\usetikzlibrary{shapes}     %?
\usetikzlibrary{fit}                    % fitting shapes to coordinates
\usetikzlibrary{backgrounds}    % drawing the background after the foreground
\usetikzlibrary{chains}
\usetikzlibrary{decorations.pathreplacing}
\usepackage[normalem]{ulem}

\usepackage{mathtools}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

\usepackage{setspace}
%\usepackage{courier}
\usepackage{xcolor}
%\usepackage{lmodern}

%% use nicer emptyset symbol
%\usepackage{amssymb} % because of MacTeX-2020
\let\emptyset\relax
\let\emptyset\varnothing

\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{booktabs}

%\usepackage{draftwatermark}
%\SetWatermarkText{Draft}
%\SetWatermarkScale{1.5}

\definecolor{rltred}{rgb}{0.75,0,0}
\definecolor{dblue}{RGB}{31,73, 125}
\definecolor{mblue}{RGB}{79,129, 189}

\lstdefinelanguage{Swift52}{%
1  morekeywords={associatedtype,class,deinit,enum,extension,fileprivate,%
    func,import,init,inout,internal,let,open,operator,private,protocol,%
    public,static,struct,subscript,typealias,var,break,case,continue,%
    default,defer,do,else,fallthrough,for,guard,if,in,repeat,return,%
    switch,where,while,as,Any,catch,false,is,nil,rethrows,super,self,%
    Self,throw,throws,true,try,_,associativity,convenience,dynamic,%
    didSet,final,get,infix,indirect,lazy,mutating,none,%
    nonmutating,optional,override,postfix,precedence,prefix,Protocol,%
    required,set,Type,unowned,weak,willSet,let,mut},%
  sensitive,%
  morecomment=[s]{/*}{*/},%
  morecomment=[s]{/**}{*/},%
  morecomment=[l]//,%
  morecomment=[l]///,%
  morestring=[b]",%
  morestring=[b]""",%
  moredelim=*[directive]\#,%
  moredirectives={available,colorLiteral,column,else,elseif,endif,file,%
    fileLiteral,function,if,imageLiteral,line,selector,sourceLocation}%
 }[keywords,comments,strings,directives]%

\lstset{
  language=C, % SWift52
  basicstyle=\scriptsize\ttfamily,
%  backgroundcolor=\color{mblue!10!white},
  keywordstyle=\color{dblue},
  % underlined bold black keywords
  identifierstyle=, % nothing happens
  commentstyle=\color{red!60!black}, % white comments
  stringstyle=\sffamily, % typewriter type for strings
  showstringspaces=false,
  xleftmargin=3pt,
  xrightmargin=3pt,
  escapeinside={(*@}{@*)},
  fancyvrb=true,
%  frame=single,
%  frameround=tttt,
%  framexleftmargin=0pt,
  framextopmargin=0pt,
  framexbottommargin=0pt,
%  framexrightmargin=5pt,
%  rulecolor=\color{mblue!70!white},
%%  language=Swift,
  basewidth={0.55em,0.45em},
%  fillcolor=\color{red},
%  rulesepcolor=\color{black}
%  rulesep=1cm,
  literate={ä}{{\"a}}1
           {ö}{{\"o}}1
           {ü}{{\"u}}1
           {Ä}{{\"A}}1
           {Ö}{{\"O}}1
           {Ü}{{\"U}}1
           {ß}{{\"s}}1
}
\lstset{rangebeginprefix=\/\/\ citecodesnippet-begin\ }
\lstset{rangeendprefix=\/\/\ citecodesnippet-end\ }
\lstset{includerangemarker=false}
\lstset{emph={bool,foreach,invariant,continue,nullptr,uint72_t},emphstyle=\color{dblue}}

\newcommand{\codesnippet}[4][language=C]{
{%% File: \url{#4}
\lstset{numbers=left}
\lstinputlisting[
  title=\filetitle{#2},
  linerange=#3-#3,
  #1
]
{#4}
}
}

\newcommand{\code}[1]{\lstinline[mathescape=true,basicstyle=\ttfamily]!#1!}
\newcommand{\msg}[1]{\lstinline[mathescape=true,basicstyle=\rmfamily\itshape]!#1!}
\newcommand{\CC}{C\nolinebreak\hspace{-.05em}\raisebox{.4ex}{\tiny\bf +}\nolinebreak\hspace{-.10em}\raisebox{.4ex}{\tiny\bf +}}

% GLOSSARY
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n} %% for \mathcal{P} correct symbol for failure detector

% hmpf
\hyphenation{time-stamps}
\hyphenation{time-stamp}

\begin{document}%

\title{Vision: MLIR Rust compiler}%% working title

%\author{Thorsten Sch{\"u}tt}
%\affiliation{%
%  \institution{No Affiliation}
%  \city{Berlin}
%  \country{Germany}
%}

\begin{abstract}
% 4 Sentences:
% State the problem
% Say why it's an interesting problem
% Say what your solution achieves
% Say what follows from your solution
\end{abstract}

\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10002951.10002952.10002971</concept_id>
<concept_desc>Information systems~Data structures</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10010520.10010575.10010580</concept_id>
<concept_desc>Computer systems organization~Processors and memory architectures</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10010583.10010600.10010607.10010610</concept_id>
<concept_desc>Hardware~Non-volatile memory</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10011007.10010940.10010992.10010993.10010996</concept_id>
<concept_desc>Software and its engineering~Consistency</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Information systems~Data structures}
\ccsdesc[500]{Computer systems organization~Processors and memory architectures}
%\ccsdesc[500]{Hardware~Non-volatile memory}
\ccsdesc[500]{Software and its engineering~Consistency}

\keywords{Rust, MLIR, LLVM}

\maketitle

% Use the following at camera-ready time to suppress page numbers.
% Comment it out when you first submit the paper for review.
% \thispagestyle{empty}

%\noindent\ddraft

% \tableofcontents

\section{Introduction}
%% Write the list of contributions first (as bulleted list)
%% The list of contributions drives the entire paper:
%% the paper substantiates the claims you have made
%% Reader thinks ``gosh, if they can really deliver this,
%% that's be exciting; I'd better read on''
%%
%% - We give the syntax and semantics of a language
%%   that supports concurrent processes (Section 3).
%%   Its innovative features are...
%% - We prove that the type system is sound, and
%%   that type checking is decidable (Section 4)
%% - We have built a GUI toolkit in WizWoz, and
%%   used it to implement a text editor (Section 5).
%%   The result is half the length of the Java version.
%%
%% Instead of ``The rest of this paper is structured...'', use forward
%% references from the narrative in the introduction.

Flang is the first production-ready open source compiler built on the
MLIR project. There is not yet much knowledge in designing compilers
for programming languages on top of MLIR. The community has its focus
on ML.

LLVM~\cite{lattner2004llvm} is a great compiler for scalar
optimizations.


Regehr~\cite{https://doi.org/10.48550/arxiv.1809.02161} mostly focused
on future directions on optimizations. Instead, we discuss how to
exploit different levels of abstractions to optimize code relying on
~MLIR~\cite{lattner2021mlir}. At higher abstraction, there will be
structured control flow and language specific constructs:
\begin{lstlisting}{language=Rust}
let mut sum = 0;
for n in 1..11 {
    sum += n;
}
\end{lstlisting}
At the bottom of the stack, there will be branches and
$\phi$s. Ranger~\cite{ranger} is a project in GCC that determines
value ranges of variables. \code{n} will have the values $1$ to
$10$. \code{sum} starts at $0$ and goes up to $55$. In fact
\code{1..11} and the iterator loop are constant expressions.

We make the following main contributions:\ts{revisit}
\begin{itemize}[topsep=0pt,itemsep=0pt,parsep=0pt]
\item We designed an highly-optimizing Rust compiler, see
  \secref{sec.compiler}.
\item The AST facilitates tooling, see \secref{sec.tooling}.
\item Our evaluation shows that our extension makes OpenMP more
  scalable, see \secref{sec.evaluation}.
\item You will find links to all system descriptions and all source, data,
  scripts, and gnuplot files in \secref{sec.reproducibility}.
\end{itemize}

\section{Problem Statement}


\section{System Model\label{sec.systemmodel}}

We consider an asynchronous, shared memory system with $N$ processes
that communicate via access to typed objects using atomic read, write, and
compare-and-swap operations. Processes can run at arbitrary speed.

We refuse to consider byzantine errors.

We consider byzantine errors in Appendix 1.

\section{Background}

In the following, we discuss some preliminaries.


\section{Experimental Setup}

Due to the high core counts of our machines, we limited the CPU
frequency.


%% begin: \ts{DO NOT EDIT!}
For each measurement, we report the median among 1,000 samples. The 99
percent confidence interval (CI) is always within the 1.5 percent of
the reported medians. Extremely short runs show slightly larger
percentages.
%% end: \ts{DO NOT EDIT!}

\section{Semantic Analysis\label{sec.sema} --- TO BE DONE}

\subsection{Abstract Syntax Tree}

\begin{itemize}
  \item Type checking
\end{itemize}

\subsection{Flow}

Secret sauce

\begin{itemize}
\item Borrow checking
\item non-lexical lifetimes
\item uninitialized values
\end{itemize}

What is the right level of abstraction for borrow checking?

\section{IR Design for programming languages\label{sec.irdesign} --- TO BE DONE}

The top level IR is the AST (abstract syntax tree).

\begin{itemize}
\item Hir: AST-like IR. It models the AST closely, i.e., structured control flow, ...
\item Mir: similar but with alloca, without loopexpressions. iterators?
\item Lir: branches
\end{itemize}

What and how many levels of abstraction are needed to generate super efficient code?
Self-contained IR or mix with other MLIR dialects?

\subsection{Programming Models}
OpenMP, SYCL~\cite{mlirsycl}, OpenACC, CUDA, ..+


\section{Optimizations\label{sec.opt} --- TO BE DONE}

\subsection{MemorySSA}

\subsection{Attributer}

\subsection{LICM at Hir}

\subsection{Fat Loop Pass}

\section{Patterns}

\subsection{HLFIR}

Local variables as SSA values. AssingOp.

An IR without alloca for local variables.

\subsection{Fortan SUM — Sum of array elements}

SUM is a Fortran Intrinsic since Fortran 90.

\begin{lstlisting}{language=Fortran}
subroutine sum_dim(a, s, d)
  integer :: a(:,:), s(:), d
  s = SUM(a, d)
end subroutine
\end{lstlisting}

The Flang community first investigated inlining strategies, see
\url{https://reviews.llvm.org/D125407}.

hlfir.\code{SumOp}: https://reviews.llvm.org/D142897

https://reviews.llvm.org/D144094

\subsection{Iterator}

\subsection{Closure}

\subsection{Optional}

\subsection{Match expressions}

\subsection{Nested module offload}

\url{https://docs.google.com/document/d/1ivYDSn_5ChTeiZ7TiO64WC_jYJnGwAUiT9Ngi9cAdFU/edit#heading=h.vzkwe9fb6eb}


\section{Evaluation\label{sec.evaluation} --- TO BE DONE}


\section{Related Work\label{sec.relatedwork} --- TO BE DONE}

\cite{click1995combining}

SCCP~\cite{wegman1991constant}

\cite{lattner2020mlir}

\cite{lattner2021mlir}

\cite{cooper2011engineering}

\cite{matsakis2014rust}

\cite{rustcdev}

\cite{hlfir}

\cite{hindley1969principal}

\cite{milner1978theory}

\cite{damas1984type}

\cite{damas1982principal}

\cite{jung2019stacked}

\cite{klabnik2019rust}

\cite{doerfert2022co}

\cite{huber2022efficient}

\cite{chase1987improvement}

\cite{mlirclang}

\cite{nllt}

\cite{johnson2017thinlto}

\cite{mrustc}

\cite{hlfirdiff}

\cite{maranget2007warnings}

\cite{gccrs}

\cite{mlirsycl}

\cite{https://doi.org/10.48550/arxiv.1809.02161}

\cite{ranger}

MemorySSA~\cite{novillo2007memory}

interprocedural memory SSA~\cite{sui2018parallel}

interprocedural memory SSA and more~\cite{sui2016svf}

MemorySSA~\cite{chow1996effective}

LLVM~\cite{lattner2004llvm}

Escape analysis~\cite{choi1999escape}

SSA~\cite{cytron1991efficiently, braun2013simple}

Value Range Analysis~\cite{birch2004value}

Rust mangling~\cite{mangling}

GVN~\cite{gargi2002sparse}

Type Checking~\cite{altidor2011taming}

Multi-level IR~\cite{gysi2021domain}

SIMD~\cite{nuzman2008outer}

SCC~\cite{tarjan1972depth}

\section{Future Work}

\begin{itemize}
\item LTO at MLIR
\item PGO at MLIR
\item What kind of optimizations ought to happen at MLIR or LLVM?
\item Closed vs. open world?
\end{itemize}

\section{Conclusion}


\section{Reproducibility\label{sec.reproducibility}}

Reproducibility~\cite{peng2011reproducible, bworld,
  donoho2008reproducible} is one of the main pillars of research. Our
goal is to support other parties to reproduce all the figures in this
paper. We will publish our code, benchmark scripts, analytics scripts,
gnuplot files, and sufficient documentation on GitHub under the Apache
License 2.0.

The reviewers will find the data HERE.


\ts{data sets?}

\ts{add link to repro guide? not anonymous?}

\footnote{\url{https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-citation-files}}

\footnote{\url{https://docs.aws.amazon.com/AmazonS3/latest/dev/EnableWebsiteHosting.html}}

\ts{with source code}

\begin{acks}
\end{acks}

\bibliographystyle{ACM-Reference-Format}
\bibliography{main}

\appendix


\section{Graphic Detail}

albeit

obviate

alleviate

accommodate

removes the need to

predominantly

circumvents the need for

eliminates the need to

annihilate

prevalent

indicate

undesirable

amortize

prevalent


reference Benchmarking@AWS

\end{document}

